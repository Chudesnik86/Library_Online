{% extends "base.html" %}

{% block title %}–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ - Library Online{% endblock %}

{% block nav %}
<a href="/admin/dashboard">–ü–∞–Ω–µ–ª—å</a>
<a href="/admin/customers">–ß–∏—Ç–∞—Ç–µ–ª–∏</a>
<a href="/admin/books">–ö–Ω–∏–≥–∏</a>
<a href="/admin/issues">–í—ã–¥–∞—á–∏</a>
<a href="/admin/reports">–û—Ç—á–µ—Ç—ã</a>
<span style="margin-left: auto; color: white;">üë®‚Äçüíº {{ user_name or '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' }}</span>
<a href="/auth/logout">–í—ã—Ö–æ–¥</a>
{% endblock %}

{% block content %}
<div class="container">
    <div class="card">
        <h1 class="card-title">–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h1>
        <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π!</p>
    </div>

    <!-- Statistics -->
    <div id="statistics" class="grid grid-4">
        <div class="stat-card">
            <div class="stat-value" id="total-customers">-</div>
            <div class="stat-label">–ß–∏—Ç–∞—Ç–µ–ª–µ–π</div>
        </div>
        <div class="stat-card success">
            <div class="stat-value" id="total-books">-</div>
            <div class="stat-label">–ö–Ω–∏–≥</div>
        </div>
        <div class="stat-card warning">
            <div class="stat-value" id="active-issues">-</div>
            <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö –≤—ã–¥–∞—á</div>
        </div>
        <div class="stat-card danger">
            <div class="stat-value" id="overdue-issues">-</div>
            <div class="stat-label">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ</div>
        </div>
    </div>

    <!-- Top Lists -->
    <div class="grid grid-2">
        <div class="card">
            <h2 class="card-title">–¢–æ–ø-5 —á–∏—Ç–∞—Ç–µ–ª–µ–π</h2>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>–ò–º—è</th>
                            <th>–ö–Ω–∏–≥ –≤–∑—è—Ç–æ</th>
                        </tr>
                    </thead>
                    <tbody id="top-customers">
                        <tr><td colspan="3" class="text-center">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="card">
            <h2 class="card-title">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–Ω–∏–≥–∏</h2>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                            <th>–í—ã–¥–∞—á</th>
                        </tr>
                    </thead>
                    <tbody id="top-books">
                        <tr><td colspan="3" class="text-center">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
    // Load statistics
    async function loadStatistics() {
        try {
            const stats = await apiCall('/api/statistics');
            
            document.getElementById('total-customers').textContent = stats.total_customers;
            document.getElementById('total-books').textContent = stats.total_books;
            document.getElementById('active-issues').textContent = stats.active_issues;
            document.getElementById('overdue-issues').textContent = stats.overdue_issues || 0;
            
            // Top customers
            const customersBody = document.getElementById('top-customers');
            if (stats.top_customers && stats.top_customers.length > 0) {
                customersBody.innerHTML = stats.top_customers.map((c, i) => `
                    <tr>
                        <td>${i + 1}</td>
                        <td>${c.customer_name}</td>
                        <td>${c.count}</td>
                    </tr>
                `).join('');
            } else {
                customersBody.innerHTML = '<tr><td colspan="3" class="text-center">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>';
            }
            
            // Top books
            const booksBody = document.getElementById('top-books');
            if (stats.top_books && stats.top_books.length > 0) {
                booksBody.innerHTML = stats.top_books.map((b, i) => `
                    <tr>
                        <td>${i + 1}</td>
                        <td>${b.book_title}</td>
                        <td>${b.count}</td>
                    </tr>
                `).join('');
            } else {
                booksBody.innerHTML = '<tr><td colspan="3" class="text-center">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>';
            }
        } catch (error) {
            showAlert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: ' + error.message, 'danger');
        }
    }

    // Load on page load
    document.addEventListener('DOMContentLoaded', loadStatistics);
</script>
{% endblock %}

