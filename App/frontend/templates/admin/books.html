{% extends "base.html" %}

{% block title %}–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–∏–≥–∞–º–∏ - Library Online{% endblock %}

{% block nav %}
<a href="/admin/dashboard">–ü–∞–Ω–µ–ª—å</a>
<a href="/admin/customers">–ß–∏—Ç–∞—Ç–µ–ª–∏</a>
<a href="/admin/books">–ö–Ω–∏–≥–∏</a>
<a href="/admin/authors">–ê–≤—Ç–æ—Ä—ã</a>
<a href="/admin/issues">–í—ã–¥–∞—á–∏</a>
<a href="/admin/exhibitions">–í—ã—Å—Ç–∞–≤–∫–∏</a>
<a href="/admin/reports">–û—Ç—á–µ—Ç—ã</a>
<span style="margin-left: auto; color: white;">üë®‚Äçüíº {{ user_name or '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' }}</span>
<a href="/auth/logout">–í—ã—Ö–æ–¥</a>
{% endblock %}

{% block content %}
<div class="container">
    <div class="card">
        <div class="flex-between">
            <h1 class="card-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–∏–≥–∞–º–∏</h1>
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-primary" onclick="showImportModal()">üì• –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ Excel</button>
                <button class="btn btn-success" onclick="showAddBookModal()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥—É</button>
            </div>
        </div>

        <div class="search-bar">
            <input type="text" class="form-control" id="search-input" placeholder="–ü–æ–∏—Å–∫ –ø–æ ID, –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –∞–≤—Ç–æ—Ä—É..." />
            <button class="btn btn-primary" onclick="searchBooks()">üîç –ü–æ–∏—Å–∫</button>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                        <th>–ê–≤—Ç–æ—Ä</th>
                        <th>ISBN</th>
                        <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                        <th>–í—Å–µ–≥–æ</th>
                        <th>–î–æ—Å—Ç—É–ø–Ω–æ</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody id="books-table">
                    <tr><td colspan="8" class="text-center">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <div id="pagination-container" style="display: none; margin-top: 1.5rem; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
            <div style="display: flex; align-items: center; gap: 1rem; flex-wrap: wrap;">
                <div style="color: var(--dark-text);">
                    –ü–æ–∫–∞–∑–∞–Ω–æ <span id="pagination-info-start">0</span> - <span id="pagination-info-end">0</span> –∏–∑ <span id="pagination-info-total">0</span> –∫–Ω–∏–≥
                </div>
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <label style="color: var(--dark-text); font-size: 0.9rem;">–ö–Ω–∏–≥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ:</label>
                    <select id="pagination-per-page" class="form-control" style="width: auto; padding: 0.25rem 0.5rem;" onchange="changePerPage(parseInt(this.value))">
                        <option value="5">5</option>
                        <option value="10">10</option>
                        <option value="15">15</option>
                        <option value="50" selected>50</option>
                    </select>
                </div>
            </div>
            <div style="display: flex; align-items: center; gap: 0.5rem;">
                <button id="pagination-prev" class="btn" onclick="changePage(currentPage - 1)" disabled>‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∞—è</button>
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <span style="color: var(--dark-text);">–°—Ç—Ä–∞–Ω–∏—Ü–∞</span>
                    <input type="number" id="pagination-page-input" min="1" value="1" 
                           style="width: 60px; padding: 0.25rem 0.5rem; border: 1px solid #ddd; border-radius: 4px; text-align: center;"
                           onchange="goToPage(parseInt(this.value))" />
                    <span style="color: var(--dark-text);">–∏–∑ <span id="pagination-total-pages">1</span></span>
                </div>
                <button id="pagination-next" class="btn" onclick="changePage(currentPage + 1)" disabled>–°–ª–µ–¥—É—é—â–∞—è ‚Üí</button>
            </div>
        </div>
    </div>
</div>

<!-- Add/Edit Book Modal -->
<div id="book-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <span class="modal-close" onclick="closeModal()">&times;</span>
            <h2 class="modal-title" id="modal-title">–î–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥—É</h2>
        </div>
        <form id="book-form">
            <input type="hidden" id="book-id" />
            <div class="form-group">
                <label>–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
                <input type="text" class="form-control" id="book-title" required />
            </div>
            <div class="form-group">
                <label>–ê–≤—Ç–æ—Ä—ã *</label>
                <div style="border: 1px solid #ddd; border-radius: 5px; padding: 0.5rem; min-height: 100px; max-height: 200px; overflow-y: auto; background: white;" id="authors-container">
                    <div style="color: var(--light-text); font-size: 0.9rem; margin-bottom: 0.5rem;">–í—ã–±–µ—Ä–∏—Ç–µ –∞–≤—Ç–æ—Ä–æ–≤ –∏–∑ —Å–ø–∏—Å–∫–∞ –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –∏–º—è –Ω–æ–≤–æ–≥–æ –∞–≤—Ç–æ—Ä–∞</div>
                    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;" id="selected-authors">
                        <!-- Selected authors will be displayed here -->
                    </div>
                    <div style="margin-top: 0.5rem;">
                        <select class="form-control" id="author-select" style="margin-bottom: 0.5rem;" onchange="addAuthorFromSelect()">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∞–≤—Ç–æ—Ä–∞...</option>
                        </select>
                        <div style="display: flex; gap: 0.5rem;">
                            <input type="text" class="form-control" id="new-author-input" placeholder="–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –∏–º—è –Ω–æ–≤–æ–≥–æ –∞–≤—Ç–æ—Ä–∞..." style="flex: 1;" />
                            <button type="button" class="btn btn-primary" onclick="addNewAuthor()">–î–æ–±–∞–≤–∏—Ç—å</button>
                        </div>
                    </div>
                </div>
                <small style="color: var(--light-text); font-size: 0.85rem; display: block; margin-top: 0.25rem;">
                    üí° –ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–æ–≤. –ê–≤—Ç–æ—Ä—ã –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é.
                </small>
            </div>
            <div class="form-group">
                <label>ISBN</label>
                <input type="text" class="form-control" id="book-isbn" />
            </div>
            <div class="form-group">
                <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                <div style="position: relative;">
                    <input type="text" class="form-control" id="book-category" list="category-list" 
                           placeholder="–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑ —Å–ø–∏—Å–∫–∞..." autocomplete="off" 
                           style="padding-right: 2.5rem;" />
                    <span style="position: absolute; right: 1rem; top: 50%; transform: translateY(-50%); 
                                 color: var(--light-text); pointer-events: none; font-size: 0.9rem;">‚ñº</span>
                </div>
                <datalist id="category-list">
                    <!-- Options will be populated by JavaScript -->
                </datalist>
                <small style="color: var(--light-text); font-size: 0.85rem; display: block; margin-top: 0.25rem;">
                    üí° –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏–∑ —Å–ø–∏—Å–∫–∞ –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—É—é
                </small>
            </div>
            <div class="form-group">
                <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
                <textarea class="form-control" id="book-description" rows="4" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–Ω–∏–≥–∏..."></textarea>
            </div>
            <div class="form-group">
                <label>–û–±–ª–æ–∂–∫–∏</label>
                <div style="border: 1px solid #ddd; border-radius: 5px; padding: 0.5rem; min-height: 100px; max-height: 300px; overflow-y: auto; background: white;" id="covers-container">
                    <div style="color: var(--light-text); font-size: 0.9rem; margin-bottom: 0.5rem;">–î–æ–±–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –æ–±–ª–æ–∂–∫–∏ –∫–Ω–∏–≥–∏</div>
                    <div id="selected-covers">
                        <!-- Selected covers will be displayed here -->
                    </div>
                    <div style="margin-top: 0.5rem;">
                        <div style="display: flex; gap: 0.5rem;">
                            <input type="url" class="form-control" id="new-cover-input" placeholder="URL –æ–±–ª–æ–∂–∫–∏ (https://...)" style="flex: 1;" />
                            <button type="button" class="btn btn-primary" onclick="addCover()">–î–æ–±–∞–≤–∏—Ç—å</button>
                        </div>
                    </div>
                </div>
                <small style="color: var(--light-text); font-size: 0.85rem; display: block; margin-top: 0.25rem;">
                    üí° –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–±–ª–æ–∂–µ–∫. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–º–æ–≥—É—Ç –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É –Ω–∏–º–∏.
                </small>
            </div>
            <div class="form-group">
                <label>–í—Å–µ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤</label>
                <input type="number" class="form-control" id="book-total" value="1" min="1" />
            </div>
            <div class="form-group">
                <label>–î–æ—Å—Ç—É–ø–Ω–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤</label>
                <input type="number" class="form-control" id="book-available" value="1" min="0" />
            </div>
            <div class="modal-footer">
                <button type="button" class="btn" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
                <button type="submit" class="btn btn-success">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </form>
    </div>
</div>

<!-- Import Books Modal -->
<div id="import-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <span class="modal-close" onclick="closeImportModal()">&times;</span>
            <h2 class="modal-title">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–Ω–∏–≥–∏ –∏–∑ Excel</h2>
        </div>
        <div style="padding: 1.5rem;">
            <div style="background: #E3F2FD; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                <h3 style="margin-top: 0; font-size: 1rem;">–§–æ—Ä–º–∞—Ç Excel —Ñ–∞–π–ª–∞:</h3>
                <p style="margin: 0.5rem 0; font-size: 0.9rem;">
                    –ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∫–æ–ª–æ–Ω–æ–∫:<br>
                    <strong>Title</strong> (–∏–ª–∏ –ù–∞–∑–≤–∞–Ω–∏–µ) - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ<br>
                    <strong>Author</strong> (–∏–ª–∏ –ê–≤—Ç–æ—Ä) - –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ<br>
                    <strong>ISBN</strong> - –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ<br>
                    <strong>Category</strong> (–∏–ª–∏ –ö–∞—Ç–µ–≥–æ—Ä–∏—è) - –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ<br>
                    <strong>Description</strong> (–∏–ª–∏ –û–ø–∏—Å–∞–Ω–∏–µ) - –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ<br>
                    <strong>Cover Image</strong> (–∏–ª–∏ –û–±–ª–æ–∂–∫–∞, URL) - –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ (URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)<br>
                    <strong>Total Copies</strong> (–∏–ª–∏ –í—Å–µ–≥–æ) - –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1)<br>
                    <strong>Available Copies</strong> (–∏–ª–∏ –î–æ—Å—Ç—É–ø–Ω–æ) - –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é = –í—Å–µ–≥–æ)
                </p>
            </div>
            
            <form id="import-form" enctype="multipart/form-data">
                <div class="form-group">
                    <label>–í—ã–±–µ—Ä–∏—Ç–µ Excel —Ñ–∞–π–ª (.xlsx, .xls) *</label>
                    <input type="file" class="form-control" id="excel-file" accept=".xlsx,.xls" required />
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn" onclick="closeImportModal()">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                </div>
            </form>
            
            <div id="import-results" style="margin-top: 1rem; display: none;"></div>
        </div>
    </div>
</div>

<!-- Book Details Modal -->
<div id="book-details-modal" class="modal">
    <div class="modal-content" style="max-width: 700px;">
        <div class="modal-header">
            <span class="modal-close" onclick="closeBookDetailsModal()">&times;</span>
            <h2 class="modal-title" id="book-details-title">–î–µ—Ç–∞–ª–∏ –∫–Ω–∏–≥–∏</h2>
        </div>
        <div style="padding: 1.5rem 0;">
            <div style="display: grid; grid-template-columns: 200px 1fr; gap: 2rem; align-items: start;">
                <div>
                    <img id="book-details-cover" src="" alt="–û–±–ª–æ–∂–∫–∞ –∫–Ω–∏–≥–∏" 
                         style="width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); 
                                background: #F3F4F6; min-height: 280px; object-fit: cover; display: block;" 
                         onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'200\' height=\'280\'%3E%3Crect fill=\'%23E5E7EB\' width=\'200\' height=\'280\'/%3E%3Ctext x=\'50%25\' y=\'50%25\' text-anchor=\'middle\' fill=\'%239CA3AF\' font-size=\'14\'%3E–ù–µ—Ç –æ–±–ª–æ–∂–∫–∏%3C/text%3E%3C/svg%3E';" />
                </div>
                <div>
                    <h3 id="book-details-title-text" style="margin-top: 0; color: var(--primary-color); font-size: 1.5rem;"></h3>
                    <div style="margin-bottom: 1rem;">
                        <p style="margin: 0.5rem 0;"><strong>–ê–≤—Ç–æ—Ä:</strong> <span id="book-details-author">-</span></p>
                        <p style="margin: 0.5rem 0;"><strong>ISBN:</strong> <span id="book-details-isbn">-</span></p>
                        <p style="margin: 0.5rem 0;"><strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> <span id="book-details-category">-</span></p>
                        <p style="margin: 0.5rem 0;"><strong>ID:</strong> <span id="book-details-id">-</span></p>
                        <p style="margin: 0.5rem 0;"><strong>–î–æ—Å—Ç—É–ø–Ω–æ:</strong> <span id="book-details-available"></span> –∏–∑ <span id="book-details-total"></span></p>
                    </div>
                    <div style="margin-top: 1.5rem;">
                        <h4 style="margin-bottom: 0.5rem; color: var(--primary-color);">–û–ø–∏—Å–∞–Ω–∏–µ:</h4>
                        <p id="book-details-description" style="line-height: 1.6; color: var(--dark-text); white-space: pre-wrap;">
                            –û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn" onclick="closeBookDetailsModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="{{ url_for('static', filename='js/admin_books.js') }}"></script>
{% endblock %}

